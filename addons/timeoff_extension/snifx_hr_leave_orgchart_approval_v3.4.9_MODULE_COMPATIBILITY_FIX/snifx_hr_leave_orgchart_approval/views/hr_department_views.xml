<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>

    <!-- Inherit Department Form View -->
    <record id="hr_department_form_view_orgchart" model="ir.ui.view">
      <field name="name">hr.department.form.orgchart.snifx</field>
      <field name="model">hr.department</field>
      <field name="inherit_id" ref="hr.view_department_form"/>
      <field name="arch" type="xml">
        
        <!-- Add org chart approval checkbox after manager_id -->
        <xpath expr="//field[@name='manager_id']" position="after">
          
          <!-- Org Chart Approval Setting -->
          <field name="use_orgchart_approval"/>
          
          <!-- Notification officers (manual selection) -->
          <label for="notification_officer_ids" string="Notification Officers"/>
          <div class="o_row">
            <field name="notification_officer_ids" 
                   widget="many2many_tags" 
                   nolabel="1"
                   placeholder="Select officers to notify (max 2 recommended)"
                   domain="[('groups_id', 'in', [%(snifx_timeoff_officer_department.group_timeoff_officer_department)d])]"
                   options="{'no_create': True, 'no_open': True}"/>
            <span class="text-muted ml-2" invisible="notification_officer_count == 0">
              (<field name="notification_officer_count" nolabel="1"/> selected)
            </span>
          </div>
          
        </xpath>
        
        <!-- Add info box at bottom -->
        <xpath expr="//sheet" position="inside">
          <group name="time_off_info" string="Time Off Approval Configuration">
            <div class="alert alert-info" role="alert" style="margin-bottom: 0;">
              <h5><strong>Approval Settings</strong></h5>
              
              <p><strong>Use Organization Chart Approval</strong></p>
              <ul>
                <li><strong>Checked (Default):</strong> Uses smart detection based on organizational hierarchy
                  <ul>
                    <li>Staff (no subordinates): 2-level approval (direct manager + senior manager)</li>
                    <li>Manager (has subordinates): 1-level approval (senior manager only)</li>
                  </ul>
                </li>
                <li><strong>Unchecked:</strong> Simple mode - only direct manager approves (1 level)
                  <ul>
                    <li>All employees: 1-level approval (direct manager only)</li>
                    <li>Use this for departments without org chart hierarchy</li>
                  </ul>
                </li>
              </ul>
              
              <hr/>
              
              <h5><strong>Notification Officers</strong></h5>
              
              <p><strong>Step 1: Assign Officers (via Snifx)</strong></p>
              <ul>
                <li>Go to Settings - Users and Companies - Users</li>
                <li>Select officer user</li>
                <li>Enable Officer: Manage Department Requests in Access Rights</li>
                <li>Go to Officer Assignments tab and assign to departments</li>
              </ul>
              
              <p><strong>Step 2: Select Notification Officers (Above)</strong></p>
              <ul>
                <li>Click Notification Officers field</li>
                <li>Select officers from dropdown (shows officers with Snifx group only)</li>
                <li>Choose 1-2 officers for this department</li>
                <li>Only selected officers with Snifx group will receive FYI notifications</li>
              </ul>
              
              <div class="alert alert-warning mt-2" role="alert">
                <strong>Note:</strong> If no officers selected, system will automatically use officers assigned via Snifx (first 2 found).
              </div>
            </div>
          </group>
        </xpath>

      </field>
    </record>

  </data>
</odoo>
